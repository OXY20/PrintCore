
# 远程打印系统项目开发文档

## 项目概述
本项目旨在开发一个基于客户端-服务端架构的远程打印系统，允许客户端通过网络连接到服务端，执行打印任务。客户端通过虚拟打印机与服务端通信，服务端调用已经配置好的本地打印机来完成打印任务。系统还应支持双面打印的功能，并实现任务状态管理和安全认证机制。

## 功能需求

### 1. 服务端功能
服务端功能包括：
1. **接收客户端连接**：服务端使用 TCP 监听客户端的连接请求。
2. **打印任务处理**：接收客户端发送的打印任务，解析任务内容和打印设置（例如纸张大小、双面打印等），并调用本地配置好的打印机进行打印，支持 PDF、图片、文本等格式，支持双面打印。
3. **任务管理**：为每个打印任务设计状态机，记录任务的执行进度（如等待中、打印中、已完成、失败等），并提供任务恢复和重试的机制。
4. **连接安全**：在连接时，服务端生成一个六位数的随机数字，客户端输入该数字（或固定密钥）后才能连接服务端，服务端记录客户端的 IP 地址、主机名或 MAC 地址，防止伪造客户端连接。
5. **多客户端支持**：服务端需要支持多客户端同时连接，确保任务处理的并发性。

### 2. 客户端功能
客户端功能包括：
1. **虚拟打印机创建**：客户端通过配置文件指定与服务端的连接信息（IP 或主机名），创建虚拟打印机。
2. **打印任务发送**：客户端将打印任务内容（如文本、图片等）传输给服务端进行处理，客户端根据需要选择是否启用双面打印等配置。
3. **认证机制**：在客户端首次连接时，客户端需输入服务端弹出的六位数认证数字，或使用固定密钥进行身份验证。

### 3. 通信协议
任务传输协议：
- 客户端和服务端之间的通信使用 JSON 格式的数据交换（可以根据需要改为二进制协议）。
- 传输的数据包括：任务内容、打印选项、任务优先级等。
任务状态反馈：客户端接收到打印任务状态更新（如任务已完成、任务失败、任务排队等）。

### 4. 安全与防伪造
六位数认证：服务端每次启动时生成一个六位数的随机数字，并要求客户端输入以完成认证。
防伪造措施：服务端记录客户端的 IP 地址或硬件 MAC 地址，确保同一客户端只能在指定的设备上连接，客户端的每次连接都需匹配已记录的设备信息，防止伪造客户端进行连接。

## CLI 设计

### 1. 服务端 CLI
服务端通过命令行界面（CLI）进行配置和启动。开发者可以通过命令行指定打印机设置、端口、日志等。

服务端命令示例：
```bash
$ remote_print_server --port 7878 --printer 'Canon Printer' --log_level info --auth_key 'secret_key'
```

参数说明：
- `--port <port>`：指定服务端监听的端口，默认端口为 '7878'。
- `--printer <printer_name>`：指定服务端使用的打印机名称。
- `--log_level <level>`：设置日志级别，'info'、'warn'、'error'。
- `--auth_key <key>`：设置固定密钥，用于客户端连接时验证身份。
- `--task_queue <max_tasks>`：设置最大并发打印任务数。

### 2. 客户端 CLI
客户端通过命令行界面进行打印任务的发送和配置。

客户端命令示例：
```bash
$ remote_print_client --server '192.168.1.100' --port 7878 --file 'document.pdf' --duplex true --auth_code '123456'
```

参数说明：
- `--server <ip_or_hostname>`：指定服务端的 IP 地址或主机名。
- `--port <port>`：指定服务端端口，默认端口为 '7878'。
- `--file <file_path>`：指定要打印的文件路径，可以是文本、PDF、图片等格式。
- `--duplex <true|false>`：是否启用双面打印。
- `--auth_code <code>`：输入服务端弹出的六位数认证数字。

## 未来 GUI 开发（Tauri）
在完成 CLI 版本后，计划使用 Tauri 开发一个 GUI 界面，提供更直观的操作界面。

### GUI 功能
1. **主界面**：显示服务端状态、已连接的客户端、任务进度等信息。
2. **任务管理**：展示打印任务的队列和状态，用户可以查看每个任务的状态（如等待中、打印中、已完成等）。
3. **连接设置**：允许用户配置服务端 IP、端口、打印机名称等。
4. **日志查看**：提供服务端和客户端的日志查看功能。

### 开发要求
- **技术栈**：Tauri + Rust。
- **跨平台**：GUI 应支持 Windows、macOS 和 Linux。
- **安全性**：GUI 界面也需要实现与 CLI 相同的安全认证机制。

## 开发与实现计划

### 阶段 1：CLI 开发
1. 实现服务端 CLI：包括端口监听、打印机配置、任务队列管理、任务处理。
2. 实现客户端 CLI：包括任务发送、打印设置、认证机制。
3. 实现任务状态机：跟踪每个任务的执行状态，并支持任务重试。
4. 测试服务端和客户端的通信、打印任务提交与状态管理。

### 阶段 2：GUI 开发
1. 使用 Tauri 开发 GUI：创建直观的用户界面，展示服务端状态、任务进度、连接设置等。
2. 完善连接设置和日志查看功能。
3. 确保 GUI 与 CLI 相同的功能和安全性。

### 阶段 3：测试与部署
1. 在 Windows 系统上进行测试，确保客户端和服务端的正常运行。
2. 完成产品文档和用户手册，指导用户配置与使用。

## 总结
此远程打印系统将提供一个高效且安全的解决方案，适用于多客户端远程连接和任务管理。CLI 界面将是初步的实现，而后期通过 Tauri 开发 GUI 界面将进一步提升用户体验。通过安全认证机制和任务状态管理，确保系统的稳定性与安全性。
