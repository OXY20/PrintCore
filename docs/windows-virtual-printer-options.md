# Windows 虚拟打印机实现方案对比

## 目标
- 在客户端创建“虚拟打印机”，拦截打印输出并转发服务端。

## 方案 A：端口监视器（Port Monitor）+ 虚拟打印机
- 思路：创建自定义端口监视器，打印数据流被写入端口时拦截。
- 优点：与系统打印流程深度集成。
- 缺点：开发复杂、需要驱动/系统级安装、签名要求高。

## 方案 B：基于 XPS 打印路径
- 思路：利用 Windows XPS 打印管线（XPS Print Path），捕获 XPS 输出。
- 优点：相对规范，文档化更好。
- 缺点：对 PDF 兼容性差，需要转换。

## 方案 C：虚拟打印机驱动（第三方）
- 思路：使用成熟虚拟打印机驱动（如 PDF/PS 虚拟打印机）作为输出，再由客户端监控输出目录。
- 优点：实现快、风险低。
- 缺点：稳定性与用户体验不如深度集成。

## 方案 D：自建打印提供程序（Print Provider）
- 思路：实现 Windows 打印提供程序，注册成新的打印提供者。
- 优点：功能完整、可扩展。
- 缺点：复杂度最高，开发和维护成本高。

## 推荐阶段路线
1. PoC 使用方案 C：快速验证端到端流程。
2. MVP 使用方案 A 或 B：提升稳定性与体验。
3. 规模化后再评估方案 D。

## 双面/纸张等设置映射
- 客户端需读取远端能力并映射到本地虚拟打印机的选项。
- 关键：确保 duplex 参数从客户端 UI 到服务端 API 再到 Windows Spooler 一致。
